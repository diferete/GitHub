select NFS_NOTAFISCAL.nfs_notafiscalseq,
                NFS_NOTAFISCAL.NFS_NotaFiscalNumero,
                NFS_NotaFiscalSerieRF,
                NFS_NotaFiscalCFOP,
                NFS_NotaFiscalDataEmissao,NFS_NotaFiscalEmpCNPJ,
                convert(varchar,NFS_NotaFiscalDataEmissao,103)as dataEmissao,
                NFS_NotaFiscalEmpEntDescricao,
                NFS_NotaFiscalPesoBruto,
                NFS_NotaFiscalPesoLiquido,
                NFS_NotaFiscalVolumes,
                NFS_NotaFiscalVolumeEspecie,
                NFS_NotaFiscalValorProdutos,
                NFS_NotaFiscalValorTotal,
                SUM(NFS_NotaFiscalItemValorTotal) as ValorTotalVenda,
                NFS_NotaFiscalValorDesconto,
                SUM(NFS_NotaFiscalItemDesconto) as DescontoItem,
                SUM(pesoOp) as pesoOp,
                NFS_NotaFiscalValorFrete
                from NFS_NOTAFISCAL left outer join NFS_NOTAFISCALITEM
                on NFS_NOTAFISCAL.NFS_NotaFiscalFilial = NFS_NOTAFISCALITEM.NFS_NotaFiscalFilial
                and NFS_NOTAFISCAL.NFS_NotaFiscalSeq = NFS_NOTAFISCALITEM.NFS_NotaFiscalSeq left outer join STEEL_PCP_CargaInsumoServ
                    on NFS_NOTAFISCALITEM.NFS_NotaFiscalFilial = STEEL_PCP_CargaInsumoServ.pdv_pedidofilial
                    and NFS_NOTAFISCALITEM.NFS_NotaFiscalItemPedidoCodigo = STEEL_PCP_CargaInsumoServ.pdv_pedidocodigo
                    and NFS_NOTAFISCALITEM.NFS_NotaFiscalItemPedidoItemSe = STEEL_PCP_CargaInsumoServ.pdv_pedidoitemseq 
                    and pdv_insserv ='RETORNO' left outer join PRO_PRODUTO 
                      on NFS_NOTAFISCALITEM.NFS_NotaFiscalItemProduto = PRO_PRODUTO.PRO_Codigo 
                where NFS_NotaFiscalDataEmissao between '01/07/2019' and '31/07/2019'
                and NFS_NotaFiscalTipo ='S'
                and NFS_NotaFiscalSituacao ='C'
                and NFS_NotaFiscalCancelada ='N' and PRO_GrupoCodigo between '0' and '99999' and PRO_SubGrupoCodigo between '0' and '99999' and PRO_FamiliaCodigo between '0' and '99999' and PRO_SubFamiliaCodigo between '0' and '99999'  and NFS_NotaFiscalItemMovVenda = 'S'  group by  NFS_NOTAFISCAL.nfs_notafiscalseq,NFS_NOTAFISCAL.NFS_NotaFiscalNumero,NFS_NotaFiscalSerieRF,
                NFS_NotaFiscalCFOP,NFS_NotaFiscalDataEmissao,NFS_NotaFiscalEmpCNPJ,
                NFS_NotaFiscalEmpEntDescricao,NFS_NotaFiscalPesoBruto,
                NFS_NotaFiscalPesoLiquido,NFS_NotaFiscalVolumes,
                NFS_NotaFiscalVolumeEspecie,NFS_NotaFiscalValorProdutos,
                NFS_NotaFiscalValorTotal,NFS_NotaFiscalValorDesconto,NFS_NotaFiscalValorFrete
                order by NFS_NotaFiscalDataEmissao desc  